<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bete-Saida Pharmacy | Stock Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-blue: #0a1f3d;
            --dark-blue: #061224;
            --medium-blue: #1a3a6c;
            --light-blue: #2d5aa0;
            --accent-blue: #3a7bd5;
            --gold: #ffd700;
            --light-gold: #fff8dc;
            --dark-gold: #b8860b;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4444;
            --gray: #8da0c7;
            --light: #e6f0ff;
            --flash-green: #00ff00;
            --flash-dark-green: #00cc00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="%23061224" opacity="0.1"/><path d="M0,0 L0,100 L100,100 Z" fill="%230a1f3d" opacity="0.1"/></svg>');
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary-blue), var(--medium-blue));
            padding: 25px 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--light-blue);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '⚕️';
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 4rem;
            opacity: 0.1;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, var(--gold), var(--dark-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .title-section h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            background: linear-gradient(to right, var(--gold), #fff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .title-section .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            letter-spacing: 1px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--accent-blue), var(--light-blue));
            color: white;
            box-shadow: 0 4px 15px rgba(58, 123, 213, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(58, 123, 213, 0.6);
        }

        .btn-success {
            background: linear-gradient(to right, var(--success), #00cc6a);
            color: var(--dark-blue);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.6);
        }

        .btn-warning {
            background: linear-gradient(to right, var(--warning), #ff8800);
            color: var(--dark-blue);
            box-shadow: 0 4px 15px rgba(255, 170, 0, 0.4);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 170, 0, 0.6);
        }

        .btn-danger {
            background: linear-gradient(to right, var(--danger), #ff0000);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 68, 68, 0.6);
        }

        .btn-gold {
            background: linear-gradient(to right, var(--gold), var(--dark-gold));
            color: var(--dark-blue);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        /* Main Content Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Stock Table Section */
        .stock-section {
            background: rgba(6, 18, 36, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--light-blue);
            backdrop-filter: blur(10px);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.8rem;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--accent-blue);
        }

        /* Search and Filter */
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 45px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--light-blue);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .filter-select {
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--light-blue);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            min-width: 200px;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .filter-select option {
            background: var(--dark-blue);
            color: white;
        }

        /* Stock Table */
        .stock-table-container {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid var(--light-blue);
            background: rgba(10, 31, 61, 0.6);
        }

        .stock-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .stock-table thead {
            background: linear-gradient(to right, var(--medium-blue), var(--light-blue));
        }

        .stock-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: white;
            border-bottom: 2px solid var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .stock-table tbody tr {
            border-bottom: 1px solid rgba(141, 160, 199, 0.2);
            transition: all 0.3s ease;
        }

        .stock-table tbody tr:hover {
            background: rgba(58, 123, 213, 0.1);
        }

        .stock-table td {
            padding: 16px 15px;
            color: var(--light);
        }

        .stock-table td:first-child {
            font-weight: 600;
            color: var(--gold);
        }

        .stock-low {
            color: var(--danger) !important;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .stock-medium {
            color: var(--warning) !important;
            font-weight: bold;
        }

        .stock-ok {
            color: var(--success) !important;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .edit-btn {
            background: rgba(58, 123, 213, 0.2);
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }

        .edit-btn:hover {
            background: var(--accent-blue);
            color: white;
        }

        .delete-btn {
            background: rgba(255, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--medium-blue), var(--light-blue));
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--gold);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: white;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Quick Actions */
        .quick-actions {
            background: rgba(6, 18, 36, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--light-blue);
            backdrop-filter: blur(10px);
        }

        .quick-actions h3 {
            color: var(--gold);
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-buttons-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        /* Charts Section */
        .charts-section {
            background: rgba(6, 18, 36, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--light-blue);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: rgba(10, 31, 61, 0.6);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--light-blue);
        }

        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--dark-blue), var(--primary-blue));
            padding: 40px;
            border-radius: 25px;
            width: 90%;
            max-width: 600px;
            border: 2px solid var(--gold);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal h2 {
            color: var(--gold);
            margin-bottom: 30px;
            font-size: 1.8rem;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--light-blue);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* Flash Message */
        .flash-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            background: linear-gradient(to right, var(--flash-green), var(--flash-dark-green));
            color: var(--dark-blue);
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(0, 255, 0, 0.3);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .flash-message.show {
            display: flex;
        }

        /* Loading Spinner */
        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(6, 18, 36, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            backdrop-filter: blur(10px);
        }

        .loading-spinner.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--gray);
            border-top: 4px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            border-top: 1px solid rgba(141, 160, 199, 0.2);
            margin-top: 30px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-section {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.85rem;
            }
            
            .stock-table th,
            .stock-table td {
                padding: 12px 8px;
                font-size: 0.85rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .modal-content {
                padding: 25px;
                margin: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(6, 18, 36, 0.6);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--light-blue), var(--accent-blue));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--accent-blue), var(--gold));
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <!-- Flash Message -->
    <div class="flash-message" id="flashMessage">
        <i class="fas fa-check-circle"></i>
        <span id="flashText">Operation successful!</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="title-section">
                        <h1>Bete-Saida Pharmacy</h1>
                        <p class="subtitle">Stock Management System</p>
                    </div>
                </div>
                <div class="header-controls">
                    <button class="btn btn-primary" onclick="showAddModal()">
                        <i class="fas fa-plus"></i> Add New Item
                    </button>
                    <button class="btn btn-gold" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button class="btn btn-warning" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i> Generate Report
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Stock Table Section -->
            <main class="stock-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-boxes"></i> Current Stock Inventory
                    </h2>
                    <div class="search-filter">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="Search medicines..." oninput="searchItems()">
                        </div>
                        <select class="filter-select" id="categoryFilter" onchange="filterItems()">
                            <option value="">All Categories</option>
                            <option value="Antibiotics">Antibiotics</option>
                            <option value="Analgesics">Analgesics</option>
                            <option value="Vitamins">Vitamins</option>
                            <option value="Cardiac">Cardiac</option>
                            <option value="Diabetes">Diabetes</option>
                            <option value="Other">Other</option>
                        </select>
                        <select class="filter-select" id="stockFilter" onchange="filterItems()">
                            <option value="">All Stock Levels</option>
                            <option value="low">Low Stock</option>
                            <option value="medium">Medium Stock</option>
                            <option value="ok">Good Stock</option>
                        </select>
                    </div>
                </div>

                <div class="stock-table-container">
                    <table class="stock-table" id="stockTable">
                        <thead>
                            <tr>
                                <th>Medicine Name</th>
                                <th>Category</th>
                                <th>Batch No.</th>
                                <th>Expiry Date</th>
                                <th>Quantity</th>
                                <th>Price (ETB)</th>
                                <th>Supplier</th>
                                <th>Stock Level</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody">
                            <!-- Stock items will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </main>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-value" id="lowStockItems">0</div>
                        <div class="stat-label">Low Stock</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <div class="stat-value" id="expiringItems">0</div>
                        <div class="stat-label">Expiring Soon</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-value" id="totalValue">0 ETB</div>
                        <div class="stat-label">Total Value</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                    <div class="action-buttons-grid">
                        <button class="btn btn-warning" onclick="showRestockModal()">
                            <i class="fas fa-truck-loading"></i> Restock Items
                        </button>
                        <button class="btn btn-danger" onclick="showExpiryModal()">
                            <i class="fas fa-calendar-times"></i> Check Expiry
                        </button>
                        <button class="btn btn-success" onclick="showAuditModal()">
                            <i class="fas fa-clipboard-check"></i> Quick Audit
                        </button>
                        <button class="btn btn-primary" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Charts Section -->
        <section class="charts-section">
            <h2 class="section-title">
                <i class="fas fa-chart-bar"></i> Stock Analytics
            </h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <canvas id="stockLevelChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="expiryChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="valueChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>Bete-Saida Pharmacy Stock Management System © 2024 | Real-time Updates Enabled</p>
            <p id="connectionStatus" style="color: var(--success); margin-top: 5px;">
                <i class="fas fa-circle"></i> Connected to Database
            </p>
        </footer>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <h2 id="modalTitle">Add New Medicine</h2>
            <form id="itemForm" onsubmit="handleSubmit(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="medicineName">Medicine Name *</label>
                        <input type="text" id="medicineName" required>
                    </div>
                    <div class="form-group">
                        <label for="category">Category *</label>
                        <select id="category" required>
                            <option value="">Select Category</option>
                            <option value="Antibiotics">Antibiotics</option>
                            <option value="Analgesics">Analgesics</option>
                            <option value="Vitamins">Vitamins</option>
                            <option value="Cardiac">Cardiac</option>
                            <option value="Diabetes">Diabetes</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="batchNumber">Batch Number *</label>
                        <input type="text" id="batchNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="expiryDate">Expiry Date *</label>
                        <input type="date" id="expiryDate" required>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Quantity *</label>
                        <input type="number" id="quantity" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="price">Price (ETB) *</label>
                        <input type="number" id="price" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="supplier">Supplier</label>
                        <input type="text" id="supplier">
                    </div>
                    <div class="form-group">
                        <label for="minStock">Minimum Stock Level</label>
                        <input type="number" id="minStock" min="0" value="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="description">Description / Notes</label>
                    <textarea id="description" rows="3"></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-success" id="submitBtn">Add Medicine</button>
                </div>
                <input type="hidden" id="itemId">
            </form>
        </div>
    </div>

    <!-- Restock Modal -->
    <div class="modal" id="restockModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeRestockModal()">&times;</button>
            <h2>Restock Low Stock Items</h2>
            <div id="restockList">
                <!-- Low stock items will be listed here -->
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="closeRestockModal()">Cancel</button>
                <button type="button" class="btn btn-success" onclick="processRestock()">Process Restock</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://myyfiatwzzumtzkjmmas.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_ob3dZIhTH8CzvQsSmn0jgg_cKP25h6s';
        const DENO_WS_URL = 'wss://ameng-gogs-esubestockb-60.deno.dev/';
        
        // Initialize Supabase
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global variables
        let stockItems = [];
        let currentEditId = null;
        let websocket = null;
        
        // Chart instances
        let stockLevelChart = null;
        let categoryChart = null;
        let expiryChart = null;
        let valueChart = null;
        
        // DOM Elements
        const stockTableBody = document.getElementById('stockTableBody');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const flashMessage = document.getElementById('flashMessage');
        const flashText = document.getElementById('flashText');
        const connectionStatus = document.getElementById('connectionStatus');
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadStockData();
            connectWebSocket();
            initializeCharts();
        });
        
        // Load stock data from Supabase
        async function loadStockData() {
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('stock_items')
                    .select('*')
                    .order('created_at', { ascending: false });
                    
                if (error) throw error;
                
                stockItems = data || [];
                renderStockTable();
                updateStats();
                updateCharts();
            } catch (error) {
                console.error('Error loading stock data:', error);
                showFlash('Error loading stock data', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Connect to WebSocket for real-time updates
        function connectWebSocket() {
            try {
                websocket = new WebSocket(DENO_WS_URL);
                
                websocket.onopen = function() {
                    console.log('WebSocket connected');
                    updateConnectionStatus(true);
                };
                
                websocket.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    if (data.type === 'stock_update') {
                        loadStockData(); // Refresh data on update
                        showFlash('Stock updated in real-time', 'success');
                    }
                };
                
                websocket.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    updateConnectionStatus(false);
                };
                
                websocket.onclose = function() {
                    console.log('WebSocket disconnected');
                    updateConnectionStatus(false);
                    // Attempt to reconnect after 5 seconds
                    setTimeout(connectWebSocket, 5000);
                };
            } catch (error) {
                console.error('Error connecting to WebSocket:', error);
            }
        }
        
        // Update connection status display
        function updateConnectionStatus(connected) {
            const statusElement = connectionStatus;
            if (connected) {
                statusElement.innerHTML = '<i class="fas fa-circle"></i> Connected to Database';
                statusElement.style.color = 'var(--success)';
            } else {
                statusElement.innerHTML = '<i class="fas fa-circle"></i> Disconnected - Reconnecting...';
                statusElement.style.color = 'var(--danger)';
            }
        }
        
        // Render stock table
        function renderStockTable(filteredItems = null) {
            const items = filteredItems || stockItems;
            stockTableBody.innerHTML = '';
            
            if (items.length === 0) {
                stockTableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-box-open" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            No stock items found
                        </td>
                    </tr>
                `;
                return;
            }
            
            items.forEach(item => {
                const stockLevel = getStockLevel(item.quantity, item.min_stock || 10);
                const stockLevelClass = `stock-${stockLevel}`;
                const stockLevelText = stockLevel.charAt(0).toUpperCase() + stockLevel.slice(1);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.medicine_name}</td>
                    <td>${item.category}</td>
                    <td>${item.batch_number}</td>
                    <td>${formatDate(item.expiry_date)}</td>
                    <td class="${stockLevelClass}">${item.quantity}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>${item.supplier || 'N/A'}</td>
                    <td><span class="${stockLevelClass}">${stockLevelText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit-btn" onclick="editItem('${item.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('${item.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                `;
                stockTableBody.appendChild(row);
            });
        }
        
        // Search functionality
        function searchItems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;
            
            let filtered = stockItems.filter(item => {
                const matchesSearch = item.medicine_name.toLowerCase().includes(searchTerm) ||
                                     item.batch_number.toLowerCase().includes(searchTerm) ||
                                     (item.supplier && item.supplier.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                
                const stockLevel = getStockLevel(item.quantity, item.min_stock || 10);
                const matchesStock = !stockFilter || stockLevel === stockFilter;
                
                return matchesSearch && matchesCategory && matchesStock;
            });
            
            renderStockTable(filtered);
        }
        
        // Filter functionality
        function filterItems() {
            searchItems(); // Reuse search logic
        }
        
        // Get stock level
        function getStockLevel(quantity, minStock) {
            if (quantity <= minStock * 0.3) return 'low';
            if (quantity <= minStock) return 'medium';
            return 'ok';
        }
        
        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-ET', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }
        
        // Update statistics
        function updateStats() {
            const totalItems = stockItems.length;
            const lowStockItems = stockItems.filter(item => 
                getStockLevel(item.quantity, item.min_stock || 10) === 'low'
            ).length;
            
            const today = new Date();
            const thirtyDaysFromNow = new Date();
            thirtyDaysFromNow.setDate(today.getDate() + 30);
            
            const expiringItems = stockItems.filter(item => {
                const expiryDate = new Date(item.expiry_date);
                return expiryDate <= thirtyDaysFromNow && expiryDate >= today;
            }).length;
            
            const totalValue = stockItems.reduce((sum, item) => 
                sum + (item.quantity * item.price), 0
            );
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('lowStockItems').textContent = lowStockItems;
            document.getElementById('expiringItems').textContent = expiringItems;
            document.getElementById('totalValue').textContent = formatCurrency(totalValue) + ' ETB';
        }
        
        // Initialize charts
        function initializeCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: 'white',
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                }
            };
            
            // Stock Level Chart
            const stockLevelCtx = document.getElementById('stockLevelChart').getContext('2d');
            stockLevelChart = new Chart(stockLevelCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Stock', 'Medium Stock', 'Good Stock'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'var(--danger)',
                            'var(--warning)',
                            'var(--success)'
                        ],
                        borderWidth: 2,
                        borderColor: 'var(--dark-blue)'
                    }]
                },
                options: chartOptions
            });
            
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Items per Category',
                        data: [],
                        backgroundColor: 'var(--accent-blue)',
                        borderColor: 'var(--light-blue)',
                        borderWidth: 1
                    }]
                },
                options: chartOptions
            });
            
            // Expiry Chart
            const expiryCtx = document.getElementById('expiryChart').getContext('2d');
            expiryChart = new Chart(expiryCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Items Expiring',
                        data: [],
                        borderColor: 'var(--danger)',
                        backgroundColor: 'rgba(255, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: chartOptions
            });
            
            // Value Chart
            const valueCtx = document.getElementById('valueChart').getContext('2d');
            valueChart = new Chart(valueCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            'var(--accent-blue)',
                            'var(--light-blue)',
                            'var(--medium-blue)',
                            'var(--gold)',
                            'var(--success)',
                            'var(--warning)'
                        ],
                        borderWidth: 2,
                        borderColor: 'var(--dark-blue)'
                    }]
                },
                options: chartOptions
            });
        }
        
        // Update charts with data
        function updateCharts() {
            // Stock Level Chart
            const lowCount = stockItems.filter(item => 
                getStockLevel(item.quantity, item.min_stock || 10) === 'low'
            ).length;
            const mediumCount = stockItems.filter(item => 
                getStockLevel(item.quantity, item.min_stock || 10) === 'medium'
            ).length;
            const goodCount = stockItems.filter(item => 
                getStockLevel(item.quantity, item.min_stock || 10) === 'ok'
            ).length;
            
            stockLevelChart.data.datasets[0].data = [lowCount, mediumCount, goodCount];
            stockLevelChart.update();
            
            // Category Chart
            const categories = {};
            stockItems.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            categoryChart.data.labels = Object.keys(categories);
            categoryChart.data.datasets[0].data = Object.values(categories);
            categoryChart.update();
            
            // Expiry Chart (next 6 months)
            const months = [];
            const expiryCounts = [];
            const today = new Date();
            
            for (let i = 0; i < 6; i++) {
                const month = new Date();
                month.setMonth(today.getMonth() + i);
                months.push(month.toLocaleDateString('en-US', { month: 'short' }));
                
                const nextMonth = new Date(month);
                nextMonth.setMonth(month.getMonth() + 1);
                
                const count = stockItems.filter(item => {
                    const expiryDate = new Date(item.expiry_date);
                    return expiryDate >= month && expiryDate < nextMonth;
                }).length;
                
                expiryCounts.push(count);
            }
            
            expiryChart.data.labels = months;
            expiryChart.data.datasets[0].data = expiryCounts;
            expiryChart.update();
            
            // Value Chart (top 5 items by value)
            const itemsByValue = [...stockItems]
                .sort((a, b) => (b.quantity * b.price) - (a.quantity * a.price))
                .slice(0, 5);
            
            valueChart.data.labels = itemsByValue.map(item => item.medicine_name);
            valueChart.data.datasets[0].data = itemsByValue.map(item => item.quantity * item.price);
            valueChart.update();
        }
        
        // Modal functions
        function showAddModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Medicine';
            document.getElementById('submitBtn').textContent = 'Add Medicine';
            document.getElementById('itemForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('itemModal').classList.add('active');
        }
        
        function showEditModal(item) {
            currentEditId = item.id;
            document.getElementById('modalTitle').textContent = 'Edit Medicine';
            document.getElementById('submitBtn').textContent = 'Update Medicine';
            document.getElementById('itemId').value = item.id;
            document.getElementById('medicineName').value = item.medicine_name;
            document.getElementById('category').value = item.category;
            document.getElementById('batchNumber').value = item.batch_number;
            document.getElementById('expiryDate').value = item.expiry_date.split('T')[0];
            document.getElementById('quantity').value = item.quantity;
            document.getElementById('price').value = item.price;
            document.getElementById('supplier').value = item.supplier || '';
            document.getElementById('minStock').value = item.min_stock || 10;
            document.getElementById('description').value = item.description || '';
            document.getElementById('itemModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('itemModal').classList.remove('active');
        }
        
        // Form submission
        async function handleSubmit(event) {
            event.preventDefault();
            
            const itemData = {
                medicine_name: document.getElementById('medicineName').value,
                category: document.getElementById('category').value,
                batch_number: document.getElementById('batchNumber').value,
                expiry_date: document.getElementById('expiryDate').value,
                quantity: parseInt(document.getElementById('quantity').value),
                price: parseFloat(document.getElementById('price').value),
                supplier: document.getElementById('supplier').value || null,
                min_stock: parseInt(document.getElementById('minStock').value) || 10,
                description: document.getElementById('description').value || null,
                updated_at: new Date().toISOString()
            };
            
            showLoading();
            
            try {
                if (currentEditId) {
                    // Update existing item
                    const { error } = await supabase
                        .from('stock_items')
                        .update(itemData)
                        .eq('id', currentEditId);
                        
                    if (error) throw error;
                    showFlash('Medicine updated successfully', 'success');
                } else {
                    // Add new item
                    itemData.created_at = new Date().toISOString();
                    const { error } = await supabase
                        .from('stock_items')
                        .insert([itemData]);
                        
                    if (error) throw error;
                    showFlash('Medicine added successfully', 'success');
                }
                
                closeModal();
                loadStockData();
                
                // Notify WebSocket
                if (websocket && websocket.readyState === WebSocket.OPEN) {
                    websocket.send(JSON.stringify({
                        type: 'stock_update',
                        timestamp: new Date().toISOString()
                    }));
                }
                
            } catch (error) {
                console.error('Error saving medicine:', error);
                showFlash('Error saving medicine: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Edit item
        async function editItem(id) {
            const item = stockItems.find(item => item.id === id);
            if (item) {
                showEditModal(item);
            }
        }
        
        // Delete item
        async function deleteItem(id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            showLoading();
            
            try {
                const { error } = await supabase
                    .from('stock_items')
                    .delete()
                    .eq('id', id);
                    
                if (error) throw error;
                
                showFlash('Medicine deleted successfully', 'success');
                loadStockData();
                
                // Notify WebSocket
                if (websocket && websocket.readyState === WebSocket.OPEN) {
                    websocket.send(JSON.stringify({
                        type: 'stock_update',
                        timestamp: new Date().toISOString()
                    }));
                }
                
            } catch (error) {
                console.error('Error deleting medicine:', error);
                showFlash('Error deleting medicine: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Restock modal
        function showRestockModal() {
            const lowStockItems = stockItems.filter(item => 
                getStockLevel(item.quantity, item.min_stock || 10) === 'low'
            );
            
            const restockList = document.getElementById('restockList');
            restockList.innerHTML = '';
            
            if (lowStockItems.length === 0) {
                restockList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--success);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>All items are sufficiently stocked!</p>
                    </div>
                `;
            } else {
                lowStockItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'form-group';
                    div.innerHTML = `
                        <label>${item.medicine_name} (Current: ${item.quantity})</label>
                        <input type="number" 
                               class="restock-quantity" 
                               data-id="${item.id}"
                               min="1" 
                               value="${(item.min_stock || 10) - item.quantity}"
                               placeholder="Quantity to add">
                    `;
                    restockList.appendChild(div);
                });
            }
            
            document.getElementById('restockModal').classList.add('active');
        }
        
        function closeRestockModal() {
            document.getElementById('restockModal').classList.remove('active');
        }
        
        async function processRestock() {
            const inputs = document.querySelectorAll('.restock-quantity');
            const updates = [];
            
            inputs.forEach(input => {
                const quantity = parseInt(input.value);
                if (quantity > 0) {
                    const itemId = input.dataset.id;
                    const item = stockItems.find(item => item.id === itemId);
                    if (item) {
                        updates.push({
                            id: itemId,
                            quantity: item.quantity + quantity
                        });
                    }
                }
            });
            
            if (updates.length === 0) {
                showFlash('No items to restock', 'warning');
                return;
            }
            
            showLoading();
            
            try {
                for (const update of updates) {
                    const { error } = await supabase
                        .from('stock_items')
                        .update({ quantity: update.quantity })
                        .eq('id', update.id);
                        
                    if (error) throw error;
                }
                
                showFlash(`${updates.length} items restocked successfully`, 'success');
                closeRestockModal();
                loadStockData();
                
                // Notify WebSocket
                if (websocket && websocket.readyState === WebSocket.OPEN) {
                    websocket.send(JSON.stringify({
                        type: 'stock_update',
                        timestamp: new Date().toISOString()
                    }));
                }
                
            } catch (error) {
                console.error('Error restocking items:', error);
                showFlash('Error restocking items: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Export to Excel
        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(stockItems.map(item => ({
                'Medicine Name': item.medicine_name,
                'Category': item.category,
                'Batch Number': item.batch_number,
                'Expiry Date': formatDate(item.expiry_date),
                'Quantity': item.quantity,
                'Price (ETB)': item.price,
                'Supplier': item.supplier || 'N/A',
                'Stock Level': getStockLevel(item.quantity, item.min_stock || 10).toUpperCase(),
                'Description': item.description || ''
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Stock Inventory');
            XLSX.writeFile(wb, `Stock_Inventory_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showFlash('Excel file exported successfully', 'success');
        }
        
        // Generate PDF Report
        function generateReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(10, 31, 61);
            doc.text('Bete-Saida Pharmacy Stock Report', 105, 20, { align: 'center' });
            
            // Add date
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
            
            // Prepare table data
            const tableData = stockItems.map(item => [
                item.medicine_name,
                item.category,
                item.batch_number,
                formatDate(item.expiry_date),
                item.quantity.toString(),
                formatCurrency(item.price),
                getStockLevel(item.quantity, item.min_stock || 10).toUpperCase()
            ]);
            
            // Add table
            doc.autoTable({
                head: [['Medicine', 'Category', 'Batch', 'Expiry', 'Qty', 'Price', 'Status']],
                body: tableData,
                startY: 40,
                theme: 'grid',
                headStyles: { fillColor: [10, 31, 61], textColor: 255 },
                alternateRowStyles: { fillColor: [240, 240, 240] },
                margin: { top: 40 }
            });
            
            // Add summary
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.setTextColor(10, 31, 61);
            doc.text('Summary:', 14, finalY);
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text(`Total Items: ${stockItems.length}`, 14, finalY + 8);
            doc.text(`Total Value: ${formatCurrency(stockItems.reduce((sum, item) => sum + (item.quantity * item.price), 0))} ETB`, 14, finalY + 16);
            
            // Save PDF
            doc.save(`Stock_Report_${new Date().toISOString().split('T')[0]}.pdf`);
            
            showFlash('PDF report generated successfully', 'success');
        }
        
        // Expiry check
        function showExpiryModal() {
            const today = new Date();
            const thirtyDaysFromNow = new Date();
            thirtyDaysFromNow.setDate(today.getDate() + 30);
            
            const expiringItems = stockItems.filter(item => {
                const expiryDate = new Date(item.expiry_date);
                return expiryDate <= thirtyDaysFromNow && expiryDate >= today;
            });
            
            if (expiringItems.length === 0) {
                showFlash('No items expiring in the next 30 days', 'success');
                return;
            }
            
            let message = `The following ${expiringItems.length} items will expire within 30 days:\n\n`;
            expiringItems.forEach(item => {
                message += `• ${item.medicine_name} (Batch: ${item.batch_number}) - Expires: ${formatDate(item.expiry_date)}\n`;
            });
            
            alert(message);
        }
        
        // Quick audit
        function showAuditModal() {
            const discrepancyItems = [];
            // Here you would compare with physical count
            // For now, just show a message
            alert('Quick Audit: Please compare the system records with physical inventory.\n\nNote: This feature requires physical verification.');
        }
        
        // Refresh data
        function refreshData() {
            loadStockData();
            showFlash('Data refreshed successfully', 'success');
        }
        
        // Show loading spinner
        function showLoading() {
            loadingSpinner.classList.add('active');
        }
        
        // Hide loading spinner
        function hideLoading() {
            loadingSpinner.classList.remove('active');
        }
        
        // Show flash message
        function showFlash(message, type = 'success') {
            flashText.textContent = message;
            
            if (type === 'error') {
                flashMessage.style.background = 'linear-gradient(to right, var(--danger), #ff0000)';
            } else if (type === 'warning') {
                flashMessage.style.background = 'linear-gradient(to right, var(--warning), #ff8800)';
            } else {
                flashMessage.style.background = 'linear-gradient(to right, var(--flash-green), var(--flash-dark-green))';
            }
            
            flashMessage.classList.add('show');
            
            setTimeout(() => {
                flashMessage.classList.remove('show');
            }, 3000);
        }
        
        // Error handling for Supabase
        function handleSupabaseError(error) {
            console.error('Supabase Error:', error);
            showFlash(`Database Error: ${error.message}`, 'error');
        }
    </script>
</body>
</html>
